<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Relay.Mutation - Relay Docs</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Relay.Mutation - Relay Docs"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/relay/"><meta property="og:description" content="A JavaScript framework for building data-driven React applications"><link rel="shortcut icon" href="/relay/img/favicon.png"><link rel="stylesheet" href="/relay/css/relay.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/relay/"><img class="nav-logo" src="/relay/img/logo.svg" width="50" height="50">Relay</a><ul class="nav-site"><li><a href="/relay/prototyping/playground.html" class="">Try it out</a></li><li><a href="/relay/docs/getting-started.html" class="active">Docs</a></li><li><a href="/relay/support.html" class="">Support</a></li><li><a href="https://github.com/facebook/relay" class="">GitHub</a></li></ul></div></div><section class="content wrap documentationContent"><div class="inner-content"><a id="content"></a><h1>Relay.Mutation</h1><div><p>Relay makes use of GraphQL mutations; operations that enable us to mutate data on the client and server. To create a mutation for use in our app, we subclass <code>Relay.Mutation</code> and implement, at minimum, the four abstract methods listed below.</p><h2><a class="anchor" name="overview"></a>Overview <a class="hash-link" href="#overview">#</a></h2><p><em>Properties</em></p><div><ul class="apiIndex">
  <li>
    <a href="#fragments-static-property">
      <pre>static fragments</pre>
      Declare this mutation's data dependencies here
    </a>
  </li>
  <li>
    <a href="#initialvariables-static-property">
      <pre>static initialVariables</pre>
      A default set of variables to make available to this mutation's fragment builders
    </a>
  </li>
  <li>
    <a href="#preparevariables-static-property">
      <pre>static prepareVariables</pre>
      A method to modify the variables based on the runtime environment, previous variables, or the meta route
    </a>
  </li>
</ul>

</div><p><em>Methods</em></p><div><ul class="apiIndex">
  <li>
    <a href="#constructor">
      <pre>constructor(props)</pre>
    </a>
  </li>
  <li>
    <a href="#getconfigs-abstract-method">
      <pre>abstract getConfigs()</pre>
    </a>
  </li>
  <li>
    <a href="#getfatquery-abstract-method">
      <pre>abstract getFatQuery()</pre>
    </a>
  </li>
  <li>
    <a href="#getmutation-abstract-method">
      <pre>abstract getMutation()</pre>
    </a>
  </li>
  <li>
    <a href="#getvariables-abstract-method">
      <pre>abstract getVariables()</pre>
    </a>
  </li>
  <li>
    <a href="#getfragment-static-method">
      <pre>static getFragment(fragmentName[, variableMapping])</pre>
    </a>
  </li>
  <li>
    <a href="#getcollisionkey">
      <pre>getCollisionKey()</pre>
    </a>
  </li>
  <li>
    <a href="#getfiles">
      <pre>getFiles()</pre>
    </a>
  </li>
  <li>
    <a href="#getoptimisticconfigs">
      <pre>getOptimisticConfigs()</pre>
    </a>
  </li>
  <li>
    <a href="#getoptimisticresponse">
      <pre>getOptimisticResponse()</pre>
    </a>
  </li>
</ul>

</div><h2><a class="anchor" name="properties"></a>Properties <a class="hash-link" href="#properties">#</a></h2><h3><a class="anchor" name="fragments-static-property"></a>fragments (static property) <a class="hash-link" href="#fragments-static-property">#</a></h3><pre class="prism language-javascript">
<span class="token keyword">static</span> fragments<span class="token punctuation">:</span> RelayMutationFragments<span class="token operator">&lt;</span>$Keys<span class="token operator">&lt;</span>Tp<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

<span spellcheck="true" class="token comment">// Type of RelayMutationFragments</span>
type RelayMutationFragments<span class="token operator">&lt;</span>Tk<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>key<span class="token punctuation">:</span> Tk<span class="token punctuation">]</span><span class="token punctuation">:</span> FragmentBuilder<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span spellcheck="true" class="token comment">// Type of FragmentBuilder</span>
type FragmentBuilder <span class="token operator">=</span> <span class="token punctuation">(</span>variables<span class="token punctuation">:</span> Variables<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> RelayConcreteNode<span class="token punctuation">;</span></pre><p>We declare our mutations&#x27; data dependencies here, just as we would with a container. This is particularly useful to ensure that a set of fields we might want to use in this mutation&#x27;s optimistic response have been fetched.</p><h4><a class="anchor" name="fragments-static-property-example"></a>Example <a class="hash-link" href="#fragments-static-property-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">LikeStoryMutation</span> <span class="token keyword">extends</span> <span class="token class-name">Relay<span class="token punctuation">.</span>Mutation</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> fragments <span class="token operator">=</span> <span class="token punctuation">{</span>
    story<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`
      fragment on Story {
        likers { count },
        viewerDoesLike,
      }
    `</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">getOptimisticResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span spellcheck="true" class="token comment">// this.props.story.likers.count and this.props.story.viewerDoesLike</span>
    <span spellcheck="true" class="token comment">// are guaranteed to have been fetched since we&#x27;ve declared</span>
    <span spellcheck="true" class="token comment">// them to be part of this mutation&#x27;s data dependencies above.</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span spellcheck="true" class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><div class="line-highlight" style="height:20px;top:20px;"></div><div class="line-highlight" style="height:20px;top:40px;"></div><div class="line-highlight" style="height:20px;top:60px;"></div><div class="line-highlight" style="height:20px;top:80px;"></div><div class="line-highlight" style="height:20px;top:100px;"></div><div class="line-highlight" style="height:20px;top:120px;"></div><div class="line-highlight" style="height:20px;top:140px;"></div><div class="line-highlight" style="height:20px;top:160px;"></div></pre><p>See also:
<a href="guides-mutations.html#fragment-variables" target="_blank">Mutations &gt; Fragment variables</a> and
<a href="guides-mutations.html#optimistic-updates" target="_blank">Mutations &gt; Optimistic updates</a></p><h3><a class="anchor" name="initialvariables-static-property"></a>initialVariables (static property) <a class="hash-link" href="#initialvariables-static-property">#</a></h3><pre class="prism language-javascript">
<span class="token keyword">static</span> initialVariables<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p>The defaults we specify here will become available to our fragment builders:</p><h4><a class="anchor" name="initialvariables-static-property-example"></a>Example <a class="hash-link" href="#initialvariables-static-property-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">ChangeTodoStatusMutation</span> <span class="token keyword">extends</span> <span class="token class-name">Relay<span class="token punctuation">.</span>Mutation</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> initialVariables <span class="token operator">=</span> <span class="token punctuation">{</span>orderby<span class="token punctuation">:</span> <span class="token string">&#x27;priority&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> fragments <span class="token operator">=</span> <span class="token punctuation">{</span>
    todos<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`
      # The variable defined above is available here as $orderby
      fragment on User { todos(orderby: $orderby) { ... } }
    `</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span spellcheck="true" class="token comment">/* ... */</span>
<span class="token punctuation">}</span></pre><p>See also:
<a href="guides-mutations.html#fragment-variables" target="_blank">Mutations &gt; Fragment variables</a></p><h3><a class="anchor" name="preparevariables-static-property"></a>prepareVariables (static property) <a class="hash-link" href="#preparevariables-static-property">#</a></h3><pre class="prism language-javascript">
<span class="token keyword">static</span> prepareVariables<span class="token punctuation">:</span> <span class="token operator">?</span><span class="token punctuation">(</span>
  prevVariables<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span><span class="token punctuation">,</span>
  route<span class="token punctuation">:</span> RelayMetaRoute<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span>

<span spellcheck="true" class="token comment">// Type of `route` argument</span>
type RelayMetaRoute <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre><p>If we provide to a mutation a method that conforms to the signature described above, it will be given the opportunity to modify the fragment builders&#x27; variables, based on the previous variables (or the <code>initialVariables</code> if no previous ones exist), the meta route, and the runtime environment. Whatever variables this method returns will become available to this mutation&#x27;s fragment builders.</p><h4><a class="anchor" name="preparevariables-static-property-example"></a>Example <a class="hash-link" href="#preparevariables-static-property-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">BuySongMutation</span> <span class="token keyword">extends</span> <span class="token class-name">Relay<span class="token punctuation">.</span>Mutation</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> initialVariables <span class="token operator">=</span> <span class="token punctuation">{</span>format<span class="token punctuation">:</span> <span class="token string">&#x27;mp3&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> prepareVariables <span class="token operator">=</span> <span class="token punctuation">(</span>prevVariables<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> overrideVariables <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> formatPreference <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#x27;formatPreference&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>formatPreference<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      overrideVariables<span class="token punctuation">.</span>format <span class="token operator">=</span> formatPreference<span class="token punctuation">;</span>  <span spellcheck="true" class="token comment">// Lossless, hopefully</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>prevVariables<span class="token punctuation">,</span> overrideVariables<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span spellcheck="true" class="token comment">/* ... */</span>
<span class="token punctuation">}</span></pre><p>See also:
<a href="guides-mutations.html#fragment-variables" target="_blank">Mutations &gt; Fragment variables</a></p><h2><a class="anchor" name="methods"></a>Methods <a class="hash-link" href="#methods">#</a></h2><h3><a class="anchor" name="constructor"></a>constructor <a class="hash-link" href="#constructor">#</a></h3><p>Create a mutation instance using the <code>new</code> keyword, optionally passing it some props. Note that <code>this.props</code> is <em>not</em> available inside the constructor function, but are set for all the methods mentioned below (<code>getCollisionKey</code>, <code>getOptimisticResponse</code>, etc). This restriction is due to the fact that mutation props may depend on data from the RelayEnvironment, which isn&#x27;t known until the mutation is applied with <code>applyUpdate</code> or <code>commitUpdate</code>.</p><h4><a class="anchor" name="constructor-example"></a>Example <a class="hash-link" href="#constructor-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">var</span> bookFlightMutation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BuyPlaneTicketMutation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>airport<span class="token punctuation">:</span> <span class="token string">&#x27;yvr&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Relay<span class="token punctuation">.</span>Store<span class="token punctuation">.</span><span class="token function">commitUpdate</span><span class="token punctuation">(</span>bookFlightMutation<span class="token punctuation">)</span><span class="token punctuation">;</span></pre><h3><a class="anchor" name="getconfigs-abstract-method"></a>getConfigs (abstract method) <a class="hash-link" href="#getconfigs-abstract-method">#</a></h3><pre class="prism language-javascript">
abstract <span class="token function">getConfigs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Array<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span><span class="token operator">&gt;</span></pre><p>Implement this required method to give Relay instructions on how to use the response payload from each mutation to update the client-side store.</p><h4><a class="anchor" name="getconfigs-abstract-method-example"></a>Example <a class="hash-link" href="#getconfigs-abstract-method-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">LikeStoryMutation</span> <span class="token keyword">extends</span> <span class="token class-name">Relay<span class="token punctuation">.</span>Mutation</span> <span class="token punctuation">{</span>
  <span class="token function">getConfigs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">&#x27;FIELDS_CHANGE&#x27;</span><span class="token punctuation">,</span>
      fieldIDs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        story<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>story<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><p>See also: <a href="guides-mutations.html#mutator-configuration" target="_blank">Mutations &gt; Mutator configuration</a></p><h3><a class="anchor" name="getfatquery-abstract-method"></a>getFatQuery (abstract method) <a class="hash-link" href="#getfatquery-abstract-method">#</a></h3><pre class="prism language-javascript">
abstract <span class="token function">getFatQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> GraphQL<span class="token punctuation">.</span>Fragment</pre><p>Implement this required method to design a ‘fat query’ – one that represents every field in your data model that could change as a result of this mutation.</p><h4><a class="anchor" name="getfatquery-abstract-method-example"></a>Example <a class="hash-link" href="#getfatquery-abstract-method-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">BuySongMutation</span> <span class="token keyword">extends</span> <span class="token class-name">Relay<span class="token punctuation">.</span>Mutation</span> <span class="token punctuation">{</span>
  <span class="token function">getFatQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`
      fragment on BuySongPayload {
        songs {
          count,
          edges,
        },
        totalRunTime,
      }
    `</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><p>See also:
<a href="guides-mutations.html#the-fat-query" target="_blank">Mutations &gt; The fat query</a></p><h3><a class="anchor" name="getmutation-abstract-method"></a>getMutation (abstract method) <a class="hash-link" href="#getmutation-abstract-method">#</a></h3><pre class="prism language-javascript">
abstract <span class="token function">getMutation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> GraphQL<span class="token punctuation">.</span>Mutation</pre><p>Implement this required method to return a GraphQL mutation operation that represents the mutation to be performed.</p><h4><a class="anchor" name="getmutation-abstract-method-example"></a>Example <a class="hash-link" href="#getmutation-abstract-method-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">LikeStoryMutation</span> <span class="token keyword">extends</span> <span class="token class-name">Relay<span class="token punctuation">.</span>Mutation</span> <span class="token punctuation">{</span>
  <span class="token function">getMutation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>story<span class="token punctuation">.</span>viewerDoesLike
      <span class="token operator">?</span> <span class="token keyword">return</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`mutation {unlikeStory}`</span></span>
      <span class="token punctuation">:</span> <span class="token keyword">return</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`mutation {likeStory}`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><h3><a class="anchor" name="getvariables-abstract-method"></a>getVariables (abstract method) <a class="hash-link" href="#getvariables-abstract-method">#</a></h3><pre class="prism language-javascript">
abstract <span class="token function">getVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span></pre><p>Implement this required method to prepare variables to be used as input to the mutation.</p><h4><a class="anchor" name="getvariables-abstract-method-example"></a>Example <a class="hash-link" href="#getvariables-abstract-method-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">DestroyShipMutation</span> <span class="token keyword">extends</span> <span class="token class-name">Relay<span class="token punctuation">.</span>Mutation</span> <span class="token punctuation">{</span>
  <span class="token function">getVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span spellcheck="true" class="token comment">// Assume that the server exposes a `destroyShip` mutation</span>
      <span spellcheck="true" class="token comment">// that accepts a `shipIDToDestroy` variable as input:</span>
      shipIDToDestroy<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>ship<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><blockquote><p>Warning</p><p>The term ‘variables’ here refers to the input to the server-side mutation, <strong>not</strong> to the variables made available to this mutation&#x27;s fragment builders.</p></blockquote><h3><a class="anchor" name="getfragment-static-method"></a>getFragment (static method) <a class="hash-link" href="#getfragment-static-method">#</a></h3><pre class="prism language-javascript">
<span class="token keyword">static</span> <span class="token function">getFragment</span><span class="token punctuation">(</span>
  fragmentName<span class="token punctuation">:</span> $Keys<span class="token operator">&lt;</span>Tp<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  variableMapping<span class="token operator">?</span><span class="token punctuation">:</span> Variables
<span class="token punctuation">)</span><span class="token punctuation">:</span> RelayFragmentReference

<span spellcheck="true" class="token comment">// Type of the variableMapping argument</span>
type Variables <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p>Gets a fragment reference for use in a parent&#x27;s query fragment.</p><h4><a class="anchor" name="getfragment-static-method-example"></a>Example <a class="hash-link" href="#getfragment-static-method-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">StoryComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span spellcheck="true" class="token comment">/* ... */</span>
  <span class="token keyword">static</span> fragments <span class="token operator">=</span> <span class="token punctuation">{</span>
    story<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL`
      fragment on Story <span class="token punctuation">{</span>
        id<span class="token punctuation">,</span>
        text<span class="token punctuation">,</span>
        $<span class="token punctuation">{</span>LikeStoryMutation<span class="token punctuation">.</span><span class="token function">getFragment</span><span class="token punctuation">(</span><span class="token string">&#x27;story&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    `<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><div class="line-highlight" style="height:20px;top:140px;"></div></pre><p>You can also pass variables to the mutation&#x27;s fragment builder from the outer fragment that contains it.</p><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">Movie</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span spellcheck="true" class="token comment">/* ... */</span>
  <span class="token keyword">static</span> fragments <span class="token operator">=</span> <span class="token punctuation">{</span>
    movie<span class="token punctuation">:</span> <span class="token punctuation">(</span>variables<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL`
      fragment on Movie <span class="token punctuation">{</span>
        <span class="token function">posterImage</span><span class="token punctuation">(</span>lang<span class="token punctuation">:</span> $lang<span class="token punctuation">)</span> <span class="token punctuation">{</span> url <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">trailerVideo</span><span class="token punctuation">(</span>format<span class="token punctuation">:</span> $format<span class="token punctuation">,</span> lang<span class="token punctuation">:</span> $lang<span class="token punctuation">)</span> <span class="token punctuation">{</span> url <span class="token punctuation">}</span><span class="token punctuation">,</span>
        $<span class="token punctuation">{</span>RentMovieMutation<span class="token punctuation">.</span><span class="token function">getFragment</span><span class="token punctuation">(</span><span class="token string">&#x27;movie&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          format<span class="token punctuation">:</span> variables<span class="token punctuation">.</span>format<span class="token punctuation">,</span>
          lang<span class="token punctuation">:</span> variables<span class="token punctuation">.</span>lang<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    `<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><div class="line-highlight" style="height:20px;top:140px;"></div><div class="line-highlight" style="height:20px;top:160px;"></div><div class="line-highlight" style="height:20px;top:180px;"></div><div class="line-highlight" style="height:20px;top:200px;"></div></pre><blockquote><p>Hint</p><p>In that last example, think of <code>$format</code> and <code>variables.format</code> as the same value.</p></blockquote><h3><a class="anchor" name="getcollisionkey"></a>getCollisionKey <a class="hash-link" href="#getcollisionkey">#</a></h3><pre class="prism language-javascript">
<span class="token function">getCollisionKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span>string</pre><p>Implement this method to return a collision key. Relay will send any mutations having the same collision key to the server serially and in-order.</p><h4><a class="anchor" name="getcollisionkey-example"></a>Example <a class="hash-link" href="#getcollisionkey-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">LikeStoryMutation</span> <span class="token keyword">extends</span> <span class="token class-name">Relay<span class="token punctuation">.</span>Mutation</span> <span class="token punctuation">{</span>
  <span class="token function">getCollisionKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span spellcheck="true" class="token comment">// Give the same key to like mutations that affect the same story</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`like_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>story<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><h3><a class="anchor" name="getfiles"></a>getFiles <a class="hash-link" href="#getfiles">#</a></h3><pre class="prism language-javascript">
<span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span>FileMap

<span spellcheck="true" class="token comment">// Type of the FileMap object</span>
type FileMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> File<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p>Implement this method to return a map of <code>File</code> objects to upload as part of a mutation.</p><h4><a class="anchor" name="getfiles-example"></a>Example <a class="hash-link" href="#getfiles-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">AttachDocumentMutation</span> <span class="token keyword">extends</span> <span class="token class-name">Relay<span class="token punctuation">.</span>Mutation</span> <span class="token punctuation">{</span>
  <span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      file<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>file<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">FileUploader</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fileToAttach <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>fileInput<span class="token punctuation">.</span>files<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Relay<span class="token punctuation">.</span>Store<span class="token punctuation">.</span><span class="token function">commitUpdate</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">AttachDocumentMutation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>file<span class="token punctuation">:</span> fileToAttach<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><h3><a class="anchor" name="getoptimisticconfigs"></a>getOptimisticConfigs <a class="hash-link" href="#getoptimisticconfigs">#</a></h3><pre class="prism language-javascript">
<span class="token function">getOptimisticConfigs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Array<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span><span class="token operator">&gt;</span></pre><p>Implement this method in cases where the mutator configuration needed to handle the optimistic response needs to be different than the one that handles the server response.</p><p>See also: <a href="#getconfigs-abstract-method" target="">Relay.Mutation::getConfigs()</a></p><h3><a class="anchor" name="getoptimisticresponse"></a>getOptimisticResponse <a class="hash-link" href="#getoptimisticresponse">#</a></h3><pre class="prism language-javascript">
<span class="token function">getOptimisticResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span></pre><p>Implement this method to craft an optimistic response having the same shape as the server response payload. This optimistic response will be used to preemptively update the client cache before the server returns, giving the impression that the mutation completed instantaneously.</p><h4><a class="anchor" name="getoptimisticresponse-example"></a>Example <a class="hash-link" href="#getoptimisticresponse-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">LikeStoryMutation</span> <span class="token keyword">extends</span> <span class="token class-name">Relay<span class="token punctuation">.</span>Mutation</span> <span class="token punctuation">{</span>
  <span class="token function">getOptimisticResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      story<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>story<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        likers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          count<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>story<span class="token punctuation">.</span>likers<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        viewerDoesLike<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>story<span class="token punctuation">.</span>viewerDoesLike<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><p>See also: <a href="guides-mutations.html#optimistic-updates" target="_blank">Mutations &gt; Optimistic updates</a></p></div><div class="docs-prevnext"><a class="docs-next" href="api-reference-relay-graphql-mutation.html">Next →</a></div></div><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/getting-started.html">Getting Started</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/tutorial.html">Tutorial</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/thinking-in-graphql.html">Thinking in GraphQL</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/thinking-in-relay.html">Thinking In Relay</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/videos.html">Videos</a></li></ul></div><div class="nav-docs-section"><h3>Relay Modern</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/relay-modern.html">Introduction to Relay Modern</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/new-in-relay-modern.html">New in Relay Modern</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/relay-environment.html">The Relay &quot;Environment&quot;</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/network-layer.html">The Relay Network Layer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/query-renderer.html">QueryRenderer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/fragment-container.html">FragmentContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/refetch-container.html">RefetchContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/pagination-container.html">PaginationContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/routing.html">Routing</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/mutations.html">Mutations</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/subscriptions.html">Subscriptions</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/babel-plugin-relay.html">babel-plugin-relay</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/relay-compiler.html">Relay Compiler</a></li></ul></div><div class="nav-docs-section"><h3>Relay Compat</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/relay-compat.html">Compatibility Mode</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/conversion-playbook.html">Conversion Playbook</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/conversion-scripts.html">Conversion Scripts</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/upgrading-setvariables.html">Upgrading setVariables</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/compatibility-cheatsheet.html">Compatibility Cheatsheet</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-cheatsheet.html">API Cheatsheet</a></li></ul></div><div class="nav-docs-section"><h3>Relay Classic Guides</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/guides-containers.html">Containers</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-routes.html">Routes</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-root-container.html">Root Container</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-ready-state.html">Ready State</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-mutations.html">Mutations</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-network-layer.html">Network Layer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-babel-plugin.html">Babel Relay Plugin</a></li></ul></div><div class="nav-docs-section"><h3>GraphQL</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-relay-specification.html">GraphQL Relay Specification</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-object-identification.html">Object Identification</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-connections.html">Connection</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-mutations.html">Mutations</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-further-reading.html">Further Reading</a></li></ul></div><div class="nav-docs-section"><h3>Relay Classic API</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay.html">Relay</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-container.html">RelayContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-route.html">Relay.Route</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-renderer.html">Relay.Renderer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-root-container.html">Relay.RootContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-ql.html">Relay.QL</a></li><li><a style="margin-left:0;" class="active" href="/relay/docs/api-reference-relay-mutation.html">Relay.Mutation</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-graphql-mutation.html">Relay.GraphQLMutation</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-proptypes.html">Relay.PropTypes</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-store.html">Relay.Store</a></li></ul></div><div class="nav-docs-section"><h3>Relay Classic Interfaces</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/interfaces-relay-network-layer.html">RelayNetworkLayer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/interfaces-relay-mutation-request.html">RelayMutationRequest</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/interfaces-relay-query-request.html">RelayQueryRequest</a></li></ul></div></div></section><footer><span><a class="edit-page-link" href="https://github.com/facebook/relay/blob/master/docs/APIReference-Mutation.md" target="_blank">Edit This Page</a></span><span>Copyright © 2017 Facebook Inc</span></footer></div><div id="fb-root"></div><script>
            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
              ga('create', 'UA-71174216-1', 'auto');
              ga('send', 'pageview');
          </script></body></html>