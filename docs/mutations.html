<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Mutations | Relay Docs</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Mutations | Relay Docs"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/relay/index.html"><meta property="og:description" content="A JavaScript framework for building data-driven React applications"><link rel="shortcut icon" href="/relay/img/favicon.png"><link rel="stylesheet" href="/relay/css/relay.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/relay/"><img class="nav-logo" src="/relay/img/logo.svg" width="50" height="50">Relay</a><ul class="nav-site"><li><a href="/relay/prototyping/playground.html" class="">Try it out</a></li><li><a href="/relay/docs/getting-started.html#content" class="active">Docs</a></li><li><a href="/relay/support.html" class="">Support</a></li><li><a href="https://github.com/facebook/relay" class="">GitHub</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/getting-started.html#content">Getting Started</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/tutorial.html#content">Tutorial</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/thinking-in-graphql.html#content">Thinking in GraphQL</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/thinking-in-relay.html#content">Thinking In Relay</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/videos.html#content">Videos</a></li></ul></div><div class="nav-docs-section"><h3>Relay Modern</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/intro-to-relay-modern.html#content">Introduction to Relay Modern</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/new-in-relay-modern.html#content">New in Relay Modern</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/relay-environment.html#content">The Relay &quot;Environment&quot;</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/QueryRenderer.html#content">QueryRenderer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/FragmentContainer.html#content">FragmentContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/PaginationContainer.html#content">PaginationContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/RefetchContainer.html#content">RefetchContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/routing.html#content">Routing</a></li><li><a style="margin-left:0;" class="active" href="/relay/docs/mutations.html#content">Mutations</a></li></ul></div><div class="nav-docs-section"><h3>Converting to Modern</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/conversion-playbook.html#content">Conversion Playbook</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/conversion-scripts.html#content">Conversion Scripts</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/upgrading-setvariables.html#content">Upgrading setVariables</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/compatibility-cheatsheet.html#content">Compatibility Cheatsheet</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-cheatsheet.html#content">API Cheatsheet</a></li></ul></div><div class="nav-docs-section"><h3>Relay Classic Guides</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/guides-containers.html#content">Containers</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-routes.html#content">Routes</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-root-container.html#content">Root Container</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-ready-state.html#content">Ready State</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-mutations.html#content">Mutations</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-network-layer.html#content">Network Layer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-babel-plugin.html#content">Babel Relay Plugin</a></li></ul></div><div class="nav-docs-section"><h3>GraphQL</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-relay-specification.html#content">GraphQL Relay Specification</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-object-identification.html#content">Object Identification</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-connections.html#content">Connection</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-mutations.html#content">Mutations</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-further-reading.html#content">Further Reading</a></li></ul></div><div class="nav-docs-section"><h3>Relay Classic API</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay.html#content">Relay</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-container.html#content">RelayContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-route.html#content">Relay.Route</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-renderer.html#content">Relay.Renderer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-root-container.html#content">Relay.RootContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-ql.html#content">Relay.QL</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-mutation.html#content">Relay.Mutation</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-graphql-mutation.html#content">Relay.GraphQLMutation</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-proptypes.html#content">Relay.PropTypes</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-store.html#content">Relay.Store</a></li></ul></div><div class="nav-docs-section"><h3>Relay Classic Interfaces</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/interfaces-relay-network-layer.html#content">RelayNetworkLayer</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/interfaces-relay-mutation-request.html#content">RelayMutationRequest</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/interfaces-relay-query-request.html#content">RelayQueryRequest</a></li></ul></div></div><div class="inner-content"><a id="content"></a><a class="edit-page-link" href="https://github.com/facebook/relay/blob/master/docs/SimpleMutationsUpdatingAField.md" target="_blank">Edit on GitHub</a><h1>Mutations</h1><div><p>Relay exports <code>commitMutation(environment: Environment, config: MutationConfig)</code> for performing mutations.</p><pre class="prism language-javascript">
<span class="token keyword">const</span> <span class="token punctuation">{</span>commitMutation<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;react-relay&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>Here is an overview of <code>MutationConfig</code>:</p><pre class="prism language-javascript">
type MutationConfig <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span>
  mutation<span class="token punctuation">:</span> GraphQLTaggedNode<span class="token punctuation">,</span> <span spellcheck="true" class="token comment">// `graphql` mutation</span>
  variables<span class="token punctuation">:</span> Variables<span class="token punctuation">,</span>        <span spellcheck="true" class="token comment">// variables for the mutation</span>
  onCompleted<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token punctuation">(</span>response<span class="token punctuation">:</span> <span class="token operator">?</span>Object<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  onError<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token punctuation">(</span>error<span class="token punctuation">:</span> Error<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span spellcheck="true" class="token comment">// Returns an optimisticPayload that updates the in-memory cache if an optimisticUpdater is not provided</span>
  optimisticResponse<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Object<span class="token punctuation">,</span>
  <span spellcheck="true" class="token comment">// &#x27;Optimistically&#x27; update the in-memory cache.</span>
  optimisticUpdater<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token punctuation">(</span>proxy<span class="token punctuation">:</span> RecordSourceProxy<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span spellcheck="true" class="token comment">// Update the in-memory cache based on the server response.</span>
  updater<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token punctuation">(</span>proxy<span class="token punctuation">:</span> RecordSourceSelectorProxy<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
<span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span></pre><h2><a class="anchor" name="performing-the-mutation-on-the-server"></a>Performing the mutation on the server <a class="hash-link" href="#performing-the-mutation-on-the-server">#</a></h2><p>In a simple mutation, you only need <code>mutation</code> and <code>variables</code>:</p><pre class="prism language-javascript">
<span class="token keyword">const</span> <span class="token punctuation">{</span>commitMutation<span class="token punctuation">,</span> graphql<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;react-relay&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mutation <span class="token operator">=</span> graphql<span class="token template-string"><span class="token string">`
  mutation MarkReadNotificationMutation(
    $input: MarkReadNotificationData!
  ) {
    markReadNotification(data: $input) {
      notification {
        seenState
      }
    }
  }
`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> variables <span class="token operator">=</span> <span class="token punctuation">{</span>
  input<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    source<span class="token punctuation">,</span>
    storyID<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">markNotificationAsRead</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> storyID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">commitMutation</span><span class="token punctuation">(</span>
    environment<span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      mutation<span class="token punctuation">,</span>
      variables<span class="token punctuation">,</span>
      onCompleted<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Success!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      onError<span class="token punctuation">:</span> err <span class="token operator">=</span><span class="token operator">&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre><h1><a class="anchor" name="updating-the-client-optimistically"></a>Updating the client optimistically <a class="hash-link" href="#updating-the-client-optimistically">#</a></h1><p>To improve perceived responsiveness, you may wish to perform an &quot;optimistic update&quot;, in which the client immediately updates to reflect the anticipated new value even before the response from the server has come back. We do this by providing an optimistic updater function and adding it to the <code>MutationConfig</code> that we pass into <code>commitMutation</code>:</p><pre class="prism language-javascript">
<span class="token keyword">const</span> optimisticUpdater <span class="token operator">=</span> store <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> notification <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>storyID<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>notification<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    notification<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>SEEN<span class="token punctuation">,</span> <span class="token string">&#x27;seenState&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span spellcheck="true" class="token comment">// As before, but this time we&#x27;re passing in the updater:</span>
<span class="token function">commitMutation</span><span class="token punctuation">(</span>
  environment<span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    mutation<span class="token punctuation">,</span>
    optimisticUpdater<span class="token punctuation">,</span>
    variables<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>Alternatively, you can pass in an optimisticResponse, which returns an &quot;optimistic payload&quot; object that reflects what the server response would look like.</p><pre class="prism language-javascript">
<span class="token keyword">const</span> optimisticResponse <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> optimisticPayload <span class="token operator">=</span> <span class="token punctuation">{</span>
    markReadNotification<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      notification<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        seenState<span class="token punctuation">:</span> SEEN<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">commitMutation</span><span class="token punctuation">(</span>
  environment<span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    mutation<span class="token punctuation">,</span>
    optimisticResponse<span class="token punctuation">,</span>
    variables<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div><div class="docs-prevnext"><a class="docs-next" href="conversion-playbook.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">©2017 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
              ga('create', 'UA-71174216-1', 'auto');
              ga('send', 'pageview');
          </script></body></html>